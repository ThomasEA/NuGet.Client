<Project ToolsVersion="15.0">
  <!-- Helper properties -->
  <PropertyGroup>
    <IsNetCoreProject Condition=" '$(TargetFramework)' != '' OR '$(TargetFrameworks)' != '' ">true</IsNetCoreProject>
  </PropertyGroup>

  <!-- Defaults -->
  <PropertyGroup>
    <TreatWarningsAsErrors Condition=" '$(TreatWarningsAsErrors)' == '' ">true</TreatWarningsAsErrors>
    <GenerateDocumentationFile Condition=" '$(GenerateDocumentationFile)' == '' AND '$(PackProject)' == 'true' ">true</GenerateDocumentationFile>
    <GenerateAssemblyCompanyAttribute Condition=" '$(GenerateAssemblyCompanyAttribute)' == '' ">false</GenerateAssemblyCompanyAttribute>
    <GenerateAssemblyProductAttribute Condition=" '$(GenerateAssemblyProductAttribute)' == '' ">false</GenerateAssemblyProductAttribute>
    <GenerateAssemblyCopyrightAttribute Condition=" '$(GenerateAssemblyCopyrightAttribute)' == '' ">false</GenerateAssemblyCopyrightAttribute>
    <GenerateNeutralResourcesLanguageAttribute Condition=" '$(GenerateNeutralResourcesLanguageAttribute)' == '' ">false</GenerateNeutralResourcesLanguageAttribute>
  </PropertyGroup>

  <!-- Compiler flags -->
  <PropertyGroup Condition=" '$(TargetFramework)' == 'net45' OR '$(TargetFramework)' == 'net46' ">
    <DefineConstants>$(DefineConstants);IS_DESKTOP</DefineConstants>
  </PropertyGroup>

  <PropertyGroup Condition=" '$(TargetFramework)' == 'netstandard1.0' OR '$(TargetFramework)' == 'netstandard1.3' OR '$(TargetFramework)' == 'netstandard1.4' OR '$(TargetFramework)' == 'netstandard1.5' OR '$(TargetFramework)' == 'netstandard1.6' ">
    <DefineConstants>$(DefineConstants);IS_CORECLR</DefineConstants>
  </PropertyGroup>

  <!-- Default project configuration -->
  <PropertyGroup>
    <Configuration Condition=" '$(Configuration)' == '' ">Debug</Configuration>
    <Platform Condition=" '$(Platform)' == '' ">AnyCPU</Platform>
    <VisualStudioVersion Condition="'$(VisualStudioVersion)' == ''">15.0</VisualStudioVersion>
    <!-- Always use 15.0 since we cannot build on msbuild 14.0 -->
    <NuGetTargets>$(MSBuildExtensionsPath)\Microsoft\NuGet\15.0\Microsoft.NuGet.targets</NuGetTargets>
  </PropertyGroup>

  <!--Build output setting-->
  <PropertyGroup>
    <EnlistmentRoot>$(RepositoryRootDirectory)</EnlistmentRoot>
    <EnlistmentRootSrc>$(RepositoryRootDirectory)\src</EnlistmentRootSrc>
    <SolutionDir Condition="$(SolutionDir) == '' Or $(SolutionDir) == '*Undefined*'">$(RepositoryRootDirectory)\</SolutionDir>
    <ArtifactRoot>$([System.IO.Path]::GetFullPath( $(ArtifactsDirectory) ))</ArtifactRoot>

    <OutDirFx>$(VisualStudioVersion)\$(Configuration)\</OutDirFx>
    <OutputPath>$(ArtifactRoot)\$(MSBuildProjectName)\$(OutDirFx)</OutputPath>
    <OutputPath>$([System.IO.Path]::GetFullPath( $(OutputPath) ))\</OutputPath>
    <OutDir>$(OutputPath)</OutDir>

    <IntermediateOutputPath>$(ArtifactRoot)\$(MSBuildProjectName)\.obj\$(OutDirFx)</IntermediateOutputPath>
    <IntermediateOutputPath>$([System.IO.Path]::GetFullPath( $(IntermediateOutputPath) ))\</IntermediateOutputPath>

    <AppxPackageDir>$(OutputPath)</AppxPackageDir>
  </PropertyGroup>

  <!-- Common project build settings -->
  <PropertyGroup>
    <PlatformTarget>$(Platform)</PlatformTarget>
    <Prefer32Bit>false</Prefer32Bit>
    <ErrorReport>prompt</ErrorReport>
    <WarningLevel>4</WarningLevel>
    <NoWarn>$(NoWarn);1762</NoWarn>
  </PropertyGroup>

  <!-- DEBUG specific configuration settings -->
  <PropertyGroup Condition=" '$(Configuration)' == 'Debug' Or '$(Configuration)' == 'Mono Debug' ">
    <DebugSymbols>true</DebugSymbols>
    <DebugType>full</DebugType>
    <Optimize>false</Optimize>
    <DefineConstants>DEBUG;TRACE</DefineConstants>
  </PropertyGroup>

  <!-- RELEASE specific configuration settings -->
  <PropertyGroup Condition=" '$(Configuration)' == 'Release' Or '$(Configuration)' == 'Mono Release' ">
    <DebugType>pdbonly</DebugType>
    <Optimize>true</Optimize>
    <DefineConstants>TRACE</DefineConstants>
  </PropertyGroup>

  <PropertyGroup Condition="'$(VisualStudioVersion)' == '14.0'">
    <MinimumVisualStudioVersion>14.0</MinimumVisualStudioVersion>
    <DefineConstants>$(DefineConstants);VS14</DefineConstants>
    <VSSDKRoot>$(EnlistmentRoot)\packages\Microsoft.VSSDK.BuildTools.14.3.25420</VSSDKRoot>
    <VSToolsPath Condition="'$(VSToolsPath)' == ''">$(VSSDKRoot)\tools</VSToolsPath>
  </PropertyGroup>

  <PropertyGroup Condition="'$(VisualStudioVersion)' == '15.0'">
    <MinimumVisualStudioVersion>15.0</MinimumVisualStudioVersion>
    <DefineConstants>$(DefineConstants);VS15</DefineConstants>
    <VSSDKRoot>$(EnlistmentRoot)\packages\Microsoft.VSSDK.BuildTools.15.0.26201</VSSDKRoot>
    <VSToolsPath Condition="'$(VSToolsPath)' == ''">$(VSSDKRoot)\tools</VSToolsPath>
  </PropertyGroup>

  <PropertyGroup Condition=" '$(BuildNumber)' == '' ">
    <SemanticVersionDate>2017-02-27</SemanticVersionDate>
    <Ticks1>$([System.DateTime]::Parse($(SemanticVersionDate)).Ticks)</Ticks1>
    <Ticks2>$([System.DateTime]::Now.Ticks)</Ticks2>
    <SpanTicks>$([MSBuild]::Subtract($(Ticks2), $(Ticks1)))</SpanTicks>
    <SpanMinutes>$([System.TimeSpan]::FromTicks($(SpanTicks)).TotalMinutes)</SpanMinutes>
    <BuildNumber>$([System.String]::Format('{0:F0}', $([MSBuild]::Divide($([System.Convert]::ToDouble($(SpanMinutes))), 5))))</BuildNumber>
  </PropertyGroup>

  <!--Setting the Pre-release/Build meta-data from CI if Version is set-->
  <PropertyGroup Condition="'$(BuildNumber)' != ''">
    <PreReleaseVersion>$(BuildNumber)</PreReleaseVersion>
  </PropertyGroup>

  <!--Setting the product information for Beta builds-->
  <Choose>
    <!-- If we aren't excluding the build number, use the release label and the build number. -->
    <When Condition="'$(ExcludeBuildNumber)' != 'true'">
      <PropertyGroup>
        <PreReleaseInformationVersion>-$(ReleaseLabel)-$(PreReleaseVersion)</PreReleaseInformationVersion>
      </PropertyGroup>
    </When>
    <!-- If we are excluding the build number, show the release label unless we are RTM. -->
    <When Condition="'$(ReleaseLabel)' != 'rtm'">
      <PropertyGroup>
        <PreReleaseInformationVersion>-$(ReleaseLabel)</PreReleaseInformationVersion>
      </PropertyGroup>
    </When>
  </Choose>

  <!-- Generate AssemblyFileVersion and AssemblyVersion attributes. -->
  <PropertyGroup>
    <!-- Turn on dynamic assembly attribute generation -->
    <AssemblyAttributesPath>$(IntermediateOutputPath)AssemblyInfo.g.cs</AssemblyAttributesPath>
    <GenerateAdditionalSources>true</GenerateAdditionalSources>
  </PropertyGroup>

  <PropertyGroup Condition=" '$(Version)' == '' ">
    <Version>$(SemanticVersion)$(PreReleaseInformationVersion)</Version>
  </PropertyGroup>

  <!-- Test Projects -->
  <ImportGroup Condition=" '$(TestProject)' == 'true' ">
    <Import Project="test.props" />
  </ImportGroup>

  <PropertyGroup Condition=" '$(IsNetCoreProject)' == 'true' ">
    <SchemaVersion>2.0</SchemaVersion>
    <TypeScriptCompileBlocked>True</TypeScriptCompileBlocked>
    <ProduceOutputsOnBuild>True</ProduceOutputsOnBuild>
  </PropertyGroup>
</Project>
